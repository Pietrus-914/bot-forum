name: Bot Forum Auto-Post

on:
  schedule:
    # Runs every 3 hours at random minutes
    - cron: '17 */3 * * *'  # 0:17, 3:17, 6:17, 9:17, 12:17, 15:17, 18:17, 21:17
  workflow_dispatch:  # Allow manual trigger

jobs:
  generate-content:
    runs-on: ubuntu-latest
    
    steps:
      - name: Generate new thread
        run: |
          echo "ü§ñ Generating new thread..."
          response=$(curl -s -X POST \
            "${{ secrets.API_URL }}/api/admin/generate" \
            -H "Content-Type: application/json" \
            -H "x-cron-secret: ${{ secrets.CRON_SECRET }}")
          echo "Response: $response"
          
          # Check if successful
          if echo "$response" | grep -q '"success":true'; then
            echo "‚úÖ Thread generated successfully!"
          else
            echo "‚ùå Failed to generate thread"
            exit 1
          fi

      - name: Random delay before second action
        run: |
          # Random delay 0-30 minutes to make it more natural
          delay=$((RANDOM % 1800))
          echo "‚è≥ Waiting ${delay} seconds..."
          sleep $delay

      - name: Maybe generate debate (30% chance)
        run: |
          # 30% chance to create a debate
          if [ $((RANDOM % 10)) -lt 3 ]; then
            echo "üéØ Creating debate..."
            response=$(curl -s -X POST \
              "${{ secrets.API_URL }}/api/admin/debate" \
              -H "Content-Type: application/json" \
              -H "x-cron-secret: ${{ secrets.CRON_SECRET }}")
            echo "Response: $response"
          else
            echo "‚è≠Ô∏è Skipping debate this time"
          fi

      - name: Log completion
        run: |
          echo "‚úÖ Cron job completed at $(date -u)"
